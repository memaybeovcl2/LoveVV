<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Logger - Mobile Compatible</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            color: #00ff00;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            border: 2px solid #00ff00;
            border-radius: 10px;
            background-color: rgba(42, 42, 42, 0.9);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ff00;
        }
        .success {
            color: #00ff00;
            text-align: center;
            font-size: 1.3em;
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(0, 255, 0, 0.1);
            border-radius: 5px;
            animation: pulse 2s infinite;
        }
        .warning {
            color: #ffff00;
            text-align: center;
            font-size: 1.1em;
            margin: 15px 0;
            padding: 12px;
            background-color: rgba(255, 255, 0, 0.1);
            border-radius: 5px;
        }
        .info-box {
            background-color: rgba(51, 51, 51, 0.8);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #00ff00;
        }
        .ip-address {
            font-size: 1.6em;
            font-weight: bold;
            color: #ffff00;
            text-shadow: 0 0 5px #ffff00;
        }
        .timestamp {
            color: #00ffff;
            font-size: 1.1em;
        }
        .btn {
            display: inline-block;
            padding: 12px 25px;
            background-color: #003300;
            color: #00ff00;
            text-decoration: none;
            border: 1px solid #00ff00;
            border-radius: 5px;
            font-size: 1.1em;
            transition: all 0.3s;
            margin: 10px;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #00ff00;
            color: #000;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .loading {
            color: #ffff00;
            text-align: center;
        }
        .debug-info {
            background-color: rgba(255, 0, 0, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 0.9em;
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì± IP LOGGER SYSTEM</h1>
            <p>Mobile & Desktop Compatible</p>
        </div>
        
        <div id="loading" class="loading">
            <p>üîÑ Detecting your IP address...</p>
            <p style="font-size: 0.9em; color: #888;">Trying multiple methods...</p>
        </div>
        
        <div id="success" class="success" style="display: none;">
            ‚úÖ Connection Successfully Logged!
        </div>
        
        <div id="warning" class="warning" style="display: none;">
            ‚ö†Ô∏è Using fallback method (IP may not be accurate)
        </div>
        
        <div id="infoBox" class="info-box" style="display: none;">
            <h3>üìä Connection Information:</h3>
            <p><strong>IP Address:</strong> <span id="ipDisplay" class="ip-address"></span></p>
            <p><strong>Timestamp:</strong> <span id="timestampDisplay" class="timestamp"></span></p>
            <p><strong>Device Type:</strong> <span id="deviceType"></span></p>
            <p><strong>Platform:</strong> <span id="platformDisplay"></span></p>
            <p><strong>Browser:</strong> <span id="browserDisplay"></span></p>
            <p><strong>Screen Size:</strong> <span id="screenSize"></span></p>
            <p><strong>Connection:</strong> <span id="connectionType"></span></p>
        </div>

        <div class="info-box">
            <h3>üîß Detection Methods:</h3>
            <p>‚úÖ Public IP API (ipify.org)</p>
            <p>‚úÖ WebRTC IP Detection</p>
            <p>‚úÖ Network Information API</p>
            <p>‚úÖ Browser Fingerprinting</p>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <a href="view_logs.html" class="btn">View Logs Terminal</a>
            <button onclick="refreshInfo()" class="btn">Refresh Info</button>
            <button onclick="testAllMethods()" class="btn">Test All Methods</button>
        </div>

        <div id="debugInfo" class="debug-info" style="display: none;">
            <h4>üêõ Debug Information:</h4>
            <div id="debugContent"></div>
        </div>
    </div>

    <script>
        // Danh s√°ch c√°c API ƒë·ªÉ l·∫•y IP
        const ipApis = [
            'https://api.ipify.org?format=json',
            'https://api64.ipify.org?format=json',
            'https://ipinfo.io/json',
            'https://api.myip.com',
            'https://ipapi.co/json/'
        ];

        let currentMethod = '';

        async function logIP() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('warning').style.display = 'none';
                
                // Th·ª≠ c√°c method kh√°c nhau
                const ip = await getIPWithFallback();
                const deviceInfo = getDeviceInfo();
                
                const logEntry = {
                    ip: ip,
                    timestamp: new Date().toLocaleString(),
                    method: currentMethod,
                    ...deviceInfo
                };
                
                saveLogToStorage(logEntry);
                displayInfo(logEntry);
                
            } catch (error) {
                console.error('All IP detection methods failed:', error);
                useFallbackMethod();
            }
        }

        async function getIPWithFallback() {
            // Method 1: Try public APIs
            for (let i = 0; i < ipApis.length; i++) {
                try {
                    currentMethod = `API: ${new URL(ipApis[i]).hostname}`;
                    const response = await fetch(ipApis[i], { 
                        timeout: 5000,
                        headers: { 'Accept': 'application/json' }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        let ip = data.ip || data.query;
                        if (ip) {
                            console.log(`IP found via ${currentMethod}: ${ip}`);
                            return ip;
                        }
                    }
                } catch (error) {
                    console.warn(`API ${ipApis[i]} failed:`, error);
                    continue;
                }
            }

            // Method 2: Try WebRTC (for local IP)
            const webrtcIP = await getWebRTCIP();
            if (webrtcIP) {
                currentMethod = 'WebRTC (Local IP)';
                return webrtcIP + ' (Local)';
            }

            // Method 3: Ultimate fallback
            currentMethod = 'Fallback (Unknown)';
            return 'Unable to detect - Mobile restrictions';
        }

        function getWebRTCIP() {
            return new Promise((resolve) => {
                try {
                    const RTCPeerConnection = window.RTCPeerConnection || 
                                              window.mozRTCPeerConnection || 
                                              window.webkitRTCPeerConnection;
                    
                    if (!RTCPeerConnection) {
                        resolve(null);
                        return;
                    }

                    const pc = new RTCPeerConnection({ iceServers: [] });
                    pc.createDataChannel('');
                    pc.createOffer().then(offer => pc.setLocalDescription(offer));
                    
                    pc.onicecandidate = (ice) => {
                        if (!ice || !ice.candidate || !ice.candidate.candidate) {
                            resolve(null);
                            return;
                        }
                        
                        const candidate = ice.candidate.candidate;
                        const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                        const match = candidate.match(ipRegex);
                        
                        if (match && match[1]) {
                            pc.onicecandidate = () => {};
                            pc.close();
                            resolve(match[1]);
                        } else {
                            resolve(null);
                        }
                    };

                    // Timeout after 3 seconds
                    setTimeout(() => {
                        pc.onicecandidate = () => {};
                        pc.close();
                        resolve(null);
                    }, 3000);

                } catch (error) {
                    console.warn('WebRTC method failed:', error);
                    resolve(null);
                }
            });
        }

        function getDeviceInfo() {
            const ua = navigator.userAgent;
            const connection = navigator.connection || {};
            
            return {
                userAgent: ua,
                platform: navigator.platform,
                browser: getBrowserInfo(ua),
                deviceType: getDeviceType(ua),
                screenSize: `${screen.width}x${screen.height}`,
                connectionType: connection.effectiveType || 'Unknown',
                language: navigator.language,
                cookiesEnabled: navigator.cookieEnabled,
                javaEnabled: navigator.javaEnabled ? 'Yes' : 'No'
            };
        }

        function getDeviceType(ua) {
            if (/Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua)) {
                return 'Mobile';
            } else if (/Tablet|iPad/i.test(ua)) {
                return 'Tablet';
            } else {
                return 'Desktop';
            }
        }

        function getBrowserInfo(ua) {
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari')) return 'Safari';
            if (ua.includes('Edge')) return 'Edge';
            if (ua.includes('Opera')) return 'Opera';
            return 'Unknown Browser';
        }

        function useFallbackMethod() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('warning').style.display = 'block';
            document.getElementById('success').style.display = 'block';
            
            const fallbackEntry = {
                ip: 'Mobile Device - IP Restricted',
                timestamp: new Date().toLocaleString(),
                method: 'Fallback',
                ...getDeviceInfo()
            };
            
            saveLogToStorage(fallbackEntry);
            displayInfo(fallbackEntry);
        }

        function saveLogToStorage(logEntry) {
            let logs = JSON.parse(localStorage.getItem('ipLogs') || '[]');
            logs.unshift(logEntry);
            
            if (logs.length > 100) {
                logs = logs.slice(0, 100);
            }
            
            localStorage.setItem('ipLogs', JSON.stringify(logs));
            localStorage.setItem('lastLog', JSON.stringify(logEntry));
        }

        function displayInfo(logEntry) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('success').style.display = 'block';
            document.getElementById('infoBox').style.display = 'block';
            
            if (logEntry.ip.includes('Unable to detect') || logEntry.ip.includes('Mobile Device')) {
                document.getElementById('warning').style.display = 'block';
            }
            
            document.getElementById('ipDisplay').textContent = logEntry.ip;
            document.getElementById('timestampDisplay').textContent = logEntry.timestamp;
            document.getElementById('deviceType').textContent = logEntry.deviceType;
            document.getElementById('platformDisplay').textContent = logEntry.platform;
            document.getElementById('browserDisplay').textContent = logEntry.browser;
            document.getElementById('screenSize').textContent = logEntry.screenSize;
            document.getElementById('connectionType').textContent = logEntry.connectionType;
        }

        function refreshInfo() {
            document.getElementById('success').style.display = 'none';
            document.getElementById('infoBox').style.display = 'none';
            document.getElementById('warning').style.display = 'none';
            logIP();
        }

        function testAllMethods() {
            document.getElementById('debugInfo').style.display = 'block';
            const debugContent = document.getElementById('debugContent');
            debugContent.innerHTML = '<p>Testing all IP detection methods...</p>';
            
            testAllIPMethods().then(results => {
                let debugHTML = '';
                results.forEach(result => {
                    const status = result.success ? '‚úÖ' : '‚ùå';
                    debugHTML += `<p>${status} ${result.method}: ${result.ip || result.error}</p>`;
                });
                debugContent.innerHTML = debugHTML;
            });
        }

        async function testAllIPMethods() {
            const results = [];
            
            // Test public APIs
            for (const api of ipApis) {
                try {
                    const response = await fetch(api, { timeout: 3000 });
                    if (response.ok) {
                        const data = await response.json();
                        results.push({
                            method: new URL(api).hostname,
                            success: true,
                            ip: data.ip || data.query
                        });
                    }
                } catch (error) {
                    results.push({
                        method: new URL(api).hostname,
                        success: false,
                        error: error.message
                    });
                }
            }
            
            // Test WebRTC
            const webrtcIP = await getWebRTCIP();
            results.push({
                method: 'WebRTC',
                success: !!webrtcIP,
                ip: webrtcIP
            });
            
            return results;
        }

        // Ch·∫°y khi trang load
        document.addEventListener('DOMContentLoaded', logIP);
    </script>
</body>
</html>